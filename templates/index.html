{% extends "base.html" %}

{% block title %}Chez M√©m√© - R√©servation{% endblock %}

{% block content %}
<!-- Section Bienvenue -->
<section class="welcome-section">
    <div class="container">
        <div class="welcome-content">
            <h1 class="welcome-title">üçµ Bienvenue chez M√©m√©</h1>
            <p class="welcome-text">
                Mon petit, tu es le bienvenu dans ma maison ! Depuis que j'ai appris √† faire ce site internet, 
                je peux enfin recevoir mes petits-enfants et leurs amis comme il faut. 
                Viens donc passer quelques jours chez ta M√©m√© √† Biarritz !
            </p>
        </div>
    </div>
</section>

<!-- Section Calendrier -->
<section class="calendar-section">
    <div class="container">
        <h2 class="section-title">üìÖ Calendrier des r√©servations</h2>
        <div class="calendar-container">
            <div id="calendar"></div>
        </div>
    </div>
</section>

<!-- Section Informations utiles -->
<section class="info-section">
    <div class="container">
        <h2 class="section-title">üìç Informations utiles</h2>
        
        <!-- Photos -->
        <div class="photos-container">
            <h3>üì∏ Photos de la maison</h3>
            <div class="photos-grid">
                {% for photo in photos %}
                <div class="photo-item">
                    <img src="{{ url_for('static', filename='uploads/images/' + photo.filename) }}" 
                         alt="{{ photo.caption or 'Photo de la maison' }}">
                    {% if photo.caption %}
                    <div class="photo-caption">
                        <p>{{ photo.caption }}</p>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
                
                {% if photos|length == 0 %}
                <div class="no-photos-message">
                    <i class="fas fa-camera"></i>
                    <p>Photos √† venir...</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Adresse et acc√®s -->
        <div class="address-info">
            <h3>üè† Adresse</h3>
            <div class="address-card">
                <i class="fas fa-map-marker-alt"></i>
                <p><strong>7 avenue du Lac Marion</strong><br>64200 Biarritz</p>
            </div>
            
            <h3>üöÇ Comment venir</h3>
            <div class="transport-info">
                <div class="transport-item">
                    <i class="fas fa-train"></i>
                    <div>
                        <strong>En train</strong>
                        <p>Gare de Biarritz + 20 minutes de marche</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Section R√©servation -->
<section class="reservation-section">
    <div class="container">
        <h2 class="section-title">üõèÔ∏è R√©server le canap' de chez M√©m√©</h2>
        <p style="text-align: center; margin-bottom: 30px; color: #666;">
            Remplissez le formulaire ci-dessous pour r√©server directement votre s√©jour !
        </p>
        
        <div class="reservation-form-container">
            <form id="reservationForm" class="reservation-form" method="POST" action="/reserver">
                <div class="form-group">
                    <label for="guest_name">Nom-Pr√©nom ou Surnom</label>
                    <input type="text" id="guest_name" name="guest_name" required>
                </div>
                
                <div class="form-group">
                    <label for="start_date">Jour d'arriv√©e</label>
                    <input type="date" id="start_date" name="start_date" required>
                </div>
                
                <div class="form-group">
                    <label for="end_date">Jour de d√©part</label>
                    <input type="date" id="end_date" name="end_date" required>
                </div>
                
                <div class="form-note">
                    <small style="color: #666; font-size: 0.9rem;">
                        <strong>Note :</strong> Le jour de d√©part n'est pas inclus dans la r√©servation. 
                        Si vous r√©servez du 15 au 17, vous occupez les nuits du 15 et du 16 (2 nuits). 
                        <em>Exemple : arriv√©e le 15/11, d√©part le 17/11 = nuits du 15 et 16 r√©serv√©es (2 nuits).</em>
                    </small>
                </div>
                
                <button type="submit" class="btn btn-primary">Confirmer la r√©servation</button>
            </form>
        </div>
    </div>
</section>

<!-- Messages Flash -->
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div class="flash-messages">
            {% for category, message in messages %}
                <div class="flash-message flash-{{ category }}">
                    <span>{{ message }}</span>
                    <button class="close-flash">&times;</button>
                </div>
            {% endfor %}
        </div>
    {% endif %}
{% endwith %}
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/simple-calendar.js') }}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Formulaire de r√©servation
    const form = document.getElementById('reservationForm');
    
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(form);
        
        fetch('/reserver', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message || 'Votre demande a bien √©t√© envoy√©e pour approbation.');
                form.reset();
                // Recharger le calendrier pour afficher la nouvelle r√©servation
                location.reload();
            } else {
                alert('Erreur: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Erreur lors de l\'envoi de la demande');
        });
    });
    
    // Validation des dates
    const startDate = document.getElementById('start_date');
    const endDate = document.getElementById('end_date');
    
    startDate.addEventListener('change', function() {
        endDate.min = this.value;
    });
    
    endDate.addEventListener('change', function() {
        if (this.value <= startDate.value) {
            this.value = '';
            alert('Le jour de d√©part doit √™tre apr√®s le jour d\'arriv√©e');
        }
    });
    
    // Date minimum = aujourd'hui
    const today = new Date().toISOString().split('T')[0];
    startDate.min = today;
    
    // Le formulaire va directement soumettre √† /api/reservations via reservation.js
});
</script>
{% endblock %}